---
trigger: glob
description:
globs: src/**/*api.ts src/**/*api.tsx src/**/services/**/*.ts src/**/services/**/*.tsx src/**/api/**/*.ts src/**/api/**/*.tsx
---

# Правила работы с API

## Общие принципы

- Всегда отвечай **на русском языке**.
- Вся работа с API должна быть типизирована.
- Не дублируй клиент — используй существующий (axios, ky, $fetch, React Query, RTK Query и т.д.).
- Не отправляй запросы напрямую из компонентов, если проект использует React Query / RTK Query / сервисный слой.

## Минимизация useEffect

- Для загрузки данных применяй React Query / RTK Query или сервисный слой.
- Не используй useEffect для запросов, кроме исключительных случаев.
- При необходимости — выноси в кастомные хуки (useUser, useProducts, useCart и т.д.).
- Если запрос всё же выполняется вручную — он должен быть чистым и с обработкой ошибок.

## Ошибки и обработка

- Ошибки обрабатывай аккуратно:
    - логирование в едином месте (если предусмотрено);
    - уведомления пользователю (toast/snackbar) — когда нужно;
    - безопасное состояние, без падений интерфейса.
- Не оставляй пустые `catch` и не скрывай ошибки.

## Структура и чистота

- Ответы и тела запросов должны иметь строгие типы.
- Не смешивай бизнес-логику с API-вызовами.
- Преобразование данных — в отдельные функции/хелперы, а не в компонентах.
- Если у проекта есть единый слой API — расширяй его, а не создавай дубликаты.

## Производительность

- Используй кэширование (React Query / RTK Query), если данные повторяются.
- При поддержке сервера — применяй SSR/SSG там, где это помогает скорости загрузки.

---

## Итог

API — единый, типизированный, предсказуемый слой. Компоненты отображают данные, а не управляют запросами и побочными эффектами.
